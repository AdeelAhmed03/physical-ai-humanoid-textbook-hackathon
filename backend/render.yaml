services:
  - type: web
    name: ai-textbook-backend
    env: python
    buildCommand: pip install -r requirements.txt && pip install -r requirements-dev.txt
    startCommand: uvicorn src.main:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: PYTHON_PATH
        value: /usr/local/bin/python
      - key: QDRANT_URL
        fromService:
          name: ai-textbook-qdrant
          type: pserv
          property: host
      - key: QDRANT_API_KEY
        sync: false
      - key: EMBEDDING_MODEL_NAME
        value: sentence-transformers/all-MiniLM-L6-v2
      - key: SECRET_KEY
        sync: false
      - key: ALLOWED_ORIGINS
        value: https://ai-textbook.vercel.app,http://localhost:3000
    healthCheckPath: /health/
    plan: free

databases:
  - name: ai-textbook-qdrant
    type: pserv
    image: qdrant/qdrant
    plan: starter-plus
    envVars:
      - key: QDRANT_API_KEY
        sync: false